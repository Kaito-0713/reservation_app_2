<h1>あなたの予約一覧</h1>

<% if @reservations.any? %>
  <div style="overflow-x:auto;">
    <table border="1" cellpadding="5" style="width:100%; border-collapse:collapse;">
      <thead>
        <tr>
          <th>部屋画像</th>
          <th>部屋名 / 紹介文</th>
          <th>合計料金</th>
          <th>チェックイン</th>
          <th>チェックアウト</th>
          <th>予約確定日時</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        <% @reservations.each do |reservation| %>
          <% room = reservation.room %>
          <% nights = (reservation.end_date - reservation.start_date).to_i %>
          <% total = room.price * nights * reservation.number_of_people %>
          <tr>
            <td>
              <% if room.image&.attached? %>
                <%= image_tag room.image.variant(resize_to_fill: [100,100]) %>
              <% else %>
                <%= image_tag "room.png", size: "100x100" %>
              <% end %>
            </td>
            <td>
              <%= link_to room.name, room_path(room) %><br>
              <small><%= truncate(room.detail, length: 60) %></small>
            </td>
            <td><%= number_to_currency(total, unit: "¥", precision: 0) %></td>
            <td><%= reservation.start_date.strftime("%Y/%m/%d") %></td>
            <td><%= reservation.end_date.strftime("%Y/%m/%d") %></td>
            <td><%= reservation.created_at.strftime("%Y/%m/%d %H:%M") %></td>
            <td>
              <%= link_to "詳細", reservation_path(reservation), class: "btn btn-info btn-sm" %> |
              <%= link_to "削除", reservation_path(reservation),
                          method: :delete,
                          data: { confirm: "本当に削除しますか？" },
                          class: "btn btn-danger btn-sm" %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <p>予約はまだありません。</p>
<% end %>
